<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="generator" content="Quarkdown">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="quarkdown:root-path" content="..">
    <meta name="quarkdown:search-index" content="../search-index.json">
    <title>Pipeline - Function call expansion</title>
    <script src="../script/quarkdown.js"></script>
    <script>const capabilities = window.quarkdownCapabilities</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="../theme/theme.css" rel="stylesheet">
    <style>

body {
}

body.quarkdown-plain.quarkdown-plain,
body.quarkdown-docs.quarkdown-docs {
}

body.quarkdown-slides.quarkdown-slides .reveal {
}

@page {
    size: auto auto;}

p {
}</style>
    <script>prepare(new DocsDocument());</script>
<template id="sidebar-template"><nav class="sidebar" role="doc-toc"><ol></ol></nav>
</template>  </head>
  <body class="quarkdown quarkdown-docs">
    <header>
      <aside class="margin-area"></aside>
      <main>
        <div class="search-wrapper">
          <div class="search-field"><i class="bi bi-search"></i><input type="text" id="search-input" placeholder="Search" autocomplete="off"><kbd>/</kbd></div>
        </div>
      </main>
      <aside class="margin-area"></aside>
    </header>
    <div class="content-wrapper">
      <aside class="margin-area" id="margin-area-left">
        <div class="position-top"></div>
        <div class="position-middle"></div>
        <div class="position-bottom"></div>
      </aside>
      <main><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "7ff9d84e763543269faa5a5ae685ef9d"}'></script><style data-hidden="">.page-margin-top-left a {
    display: flex !important;
}

header .version {
    opacity: 0.6 !important;
}

.quarkdown-output {
    padding: 12px 16px !important;
    border-radius: 8px !important;
    background-color: var(--box-header-background-color) !important;
}

.quarkdown-output:empty::after {
    content: "(No output)" !important;
    color: var(--qd-main-color-muted) !important;
}

.quarkdown-output :is(h1, h2, h3, h4, h5, h6) {
    padding: 0 !important;
    border: none !important;
}

.quarkdown-output :is(h1, h2, h3, h4, h5, h6):first-child {
    margin-top: 0 !important;
}

.quarkdown-output img[src*="sky"] {
    max-width: 50% !important;
}

.box:has(.quarkdown-output) pre {
    margin-bottom: 16px !important;
}</style><div class="page-margin-content page-margin-top-left" data-on-left-page="top-left" data-on-right-page="top-left"><div style="justify-content: flex-start; align-items: center; gap: 12.0px;" class="stack stack-row"><p><a href="https://quarkdown.com"><img src="media/banner-light@2065058880.svg" alt="Quarkdown" /></a></p><span class="version">1.13.0</span></div></div><div class="page-margin-content page-margin-top-right" data-on-left-page="top-right" data-on-right-page="top-right"><div style="justify-content: flex-start; align-items: center;" class="stack stack-row"><p><a href="/docs">Docs</a></p><hr /><p><a href="https://github.com/iamgio/quarkdown"><i class="icon-image bi bi-github" aria-hidden="true"></i></a></p></div></div><div class="page-margin-content page-margin-left-top" data-on-left-page="left-top" data-on-right-page="left-top"><nav role="navigation" data-role="page-list"><h3 id="getting-started" data-decorative="">Getting started</h3><ul><li><a href="../Quickstart">Quickstart</a></li></ul><h3 id="documentation" data-decorative="">Documentation</h3><ul><li><a href="https://quarkdown.com/docs/quarkdown-stdlib/">Stable ↗</a></li><li><a href="https://quarkdown.com/docs/latest/quarkdown-stdlib/">Latest build ↗</a></li></ul><h3 id="functions" data-decorative="">Functions</h3><ul><li><a href="../Syntax-of-a-function-call">Syntax of a function call</a><ul><li><a href="../Syntax-of-a-function-call#chaining-calls">Chaining calls</a></li><li><a href="../Syntax-of-a-function-call#block-vs-inline-function-calls">Block vs. inline calls</a></li></ul></li><li><a href="../Declaring-functions">Declaring functions</a></li><li><a href="../Typing">Dynamic typing</a></li><li><a href="../Localization">Localization</a></li></ul><h3 id="document-setup" data-decorative="">Document setup</h3><ul><li><a href="../Document-metadata">Document metadata</a><ul><li><a href="../Document-types">Document types</a></li></ul></li><li><a href="../Themes">Theme</a></li><li><a href="../Font-configuration">Fonts</a></li><li><a href="../Page-format">Page format</a><ul><li><a href="../Multi-column-layout">Multi-column layout</a></li></ul></li><li><a href="../Page-margin-content">Page margin content</a></li><li><a href="../Page-counter">Page counter</a></li><li><a href="../Persistent-headings">Persistent headings</a></li><li><a href="../Numbering">Numbering</a></li><li><a href="../Paragraph-style">Paragraph style</a></li><li><a href="../Caption-position">Caption position</a></li><li><a href="../Table-of-contents">Table of contents</a></li><li><a href="../Bibliography">Bibliography</a></li><li><a href="../Footnotes">Footnotes</a></li></ul><h3 id="markdown-enhancements" data-decorative="">Markdown enhancements</h3><ul><li><a href="../Figure">Figures</a></li><li><a href="../Image-size">Image size</a></li><li><a href="../TeX-formulae">TeX formulae</a></li><li><a href="../Table-caption">Table caption</a></li><li><a href="../Code-caption">Code caption</a></li><li><a href="../Numbering#decorative-headings">Decorative headings</a></li><li><a href="../Quote-types">Alerts (quote types)</a></li><li><a href="../Quotation-source">Quotation source</a></li><li><a href="../Cross-references">Cross-references</a></li><li><a href="../Page-break">Page breaks</a><ul><li><a href="../Page-break#automatic-break">Automatic break</a></li></ul></li><li><a href="../Text-symbols">Text symbols</a></li><li><a href="../Emojis">Emojis</a></li></ul><h3 id="layout" data-decorative="">Layout</h3><ul><li><a href="../Stacks">Stacks: rows, columns, grids</a></li><li><a href="../Container">Container</a></li><li><a href="../Align">Align</a></li><li><a href="../Float">Float</a></li><li><a href="../Custom-figure">Figure</a></li><li><a href="../Clip">Clip</a></li><li><a href="../Box">Box</a></li><li><a href="../Collapsible">Collapsible</a></li><li><a href="../Landscape-content">Landscape</a></li><li><a href="../Whitespace">Whitespace</a></li></ul><h3 id="multi-file-projects" data-decorative="">Multi-file projects</h3><ul><li><a href="../Including-other-Quarkdown-files">Including other Quarkdown files</a></li><li><a href="../Subdocuments">Referencing other Quarkdown files</a><ul><li><a href="../Inclusion-vs-subdocuments">Including vs. referencing</a></li></ul></li><li><a href="../Importing-external-libraries">Importing external libraries</a></li></ul><h3 id="variables-amp-scripting" data-decorative="">Variables &amp; scripting</h3><ul><li><a href="../Variables">Variables</a></li><li><a href="../None">Optionality</a></li><li><a href="../Math">Math</a></li><li><a href="../Conditional-statements">Conditional statements</a></li><li><a href="../Loops">Loops</a></li><li><a href="../Let">Let</a></li><li><a href="../Destructuring">Destructuring</a></li></ul><h3 id="data-amp-tables" data-decorative="">Data &amp; tables</h3><ul><li><a href="../Table-manipulation">Table manipulation</a></li><li><a href="../Table-generation">Table generation</a></li><li><a href="../File-data#file-text-content">Text content from file</a></li><li><a href="../File-data#table-from-csv">Table from CSV data</a></li></ul><h3 id="charts-amp-diagrams" data-decorative="">Charts &amp; diagrams</h3><ul><li><a href="../XY-chart">XY chart</a></li><li><a href="../Mermaid-diagrams">Mermaid diagrams</a></li></ul><h3 id="text-amp-code" data-decorative="">Text &amp; code</h3><ul><li><a href="../Text">Advanced text formatting</a></li><li><a href="../Code">Advanced code block</a></li><li><a href="../Line-breaks">Explicit line breaks</a></li><li><a href="../TeX-macros">TeX macros</a></li></ul><h3 id="slides" data-decorative="">Slides</h3><ul><li><a href="../Slides-configuration">Slides configuration</a></li><li><a href="../Slides-fragment">Interactive fragment</a></li><li><a href="../Slides-speaker-notes">Speaker notes</a></li></ul><h3 id="native-content" data-decorative="">Native content</h3><ul><li><a href="../HTML">HTML</a></li><li><a href="../CSS">CSS</a></li></ul><h3 id="value-types" data-decorative="">Value types</h3><ul><li>String</li><li>Number</li><li><a href="../Markdown-content">Markdown content</a></li><li><a href="../Boolean">Boolean</a></li><li><a href="../None">None</a></li><li><a href="../Enumeration-entry">Enumeration entry</a></li><li><a href="../Iterable">Iterable</a></li><li><a href="../Dictionary">Dictionary</a></li><li><a href="../Range">Range</a></li><li><a href="../Lambda">Lambda</a></li><li><a href="../Sizes">Size(s)</a></li><li><a href="../Color">Color</a></li><li><a href="../Typing">Dynamic</a></li></ul><h3 id="built-in-libraries" data-decorative="">Built-in libraries</h3><ul><li><a href="../Paper-library">Paper: abstract, definitions, theorems</a></li></ul><h3 id="resources-amp-logging" data-decorative="">Resources &amp; logging</h3><ul><li><a href="../Media-storage">Media storage</a></li><li><a href="../Logging">Logging</a></li></ul><h3 id="cli-tools" data-decorative="">CLI tools</h3><ul><li><a href="../CLI-Compiler">Compiler</a></li><li><a href="../PDF-export">Exporting to PDF</a></li><li><a href="../CLI-Project-creator">Project creator</a></li><li><a href="../CLI-Webserver">Webserver</a></li></ul><h3 id="inside-quarkdown" data-decorative="">Inside Quarkdown</h3><ul><li><a href="../Pipeline">Quarkdown&rsquo;s pipeline</a><ul><li><a href="../Pipeline---Lexing">Lexing</a></li><li><a href="../Pipeline---Parsing">Parsing</a></li><li><a href="../Pipeline---Function-call-expansion" aria-current="page">Function call expansion</a></li><li><a href="../Pipeline---Tree-traversal">Tree traversal</a></li><li><a href="../Pipeline---Rendering">Rendering</a></li><li><a href="../Pipeline---Post-rendering">Post-rendering</a></li></ul></li><li><a href="../Inside-live-preview">How does live preview work?</a></li></ul></nav></div><div class="page-margin-content page-margin-right-top" data-on-left-page="right-top" data-on-right-page="right-top"><h3 id="table-of-contents">On this page</h3><nav role="table-of-contents" data-role="table-of-contents"><ol></ol></nav></div><h1 id="pipeline---function-call-expansion" data-decorative="">Pipeline - Function call expansion</h1><blockquote><p>Main packages: <a href="https://github.com/iamgio/quarkdown/tree/main/quarkdown-core/src/main/kotlin/com/quarkdown/core/function"><span><span class="codespan-content"><code>core.function</code></span></span></a></p></blockquote><p>Among the nodes generated from the <a href="../Pipeline---Parsing">Parsing</a> stage, those of type <span class="codespan-content"><code>FunctionCallNode(context, name, arguments)</code></span> represent <a href="../Syntax-of-a-function-call">function calls</a>.</p><p>While all other nodes never change after they are created, this is the only kind of <em>mutable</em> node, which means its inner data is expected to change after the AST has been fully generated. Its mutation affects its child nodes, which is initially an empty collection that is later populated by a component called <em>function call expander</em>.</p><p>Before addressing the expansion itself, we should understand how data is exchanged among functions. Quarkdown functions, either explicitly or implicitly, always return a <a href="https://github.com/iamgio/quarkdown/tree/main/quarkdown-core/src/main/kotlin/eu/iamgio/quarkdown/function/value"><span class="codespan-content"><code>Value</code></span></a>, a type-checked object wrapper.</p><p>In Quarkdown, not all types can be returned and not all types can be used as arguments. Therefore, functions should feature <span class="codespan-content"><code>InputValue</code></span> parameters and return an <span class="codespan-content"><code>OutputValue</code></span>. A complete set of value types is visualized in the following Venn-UML diagram:</p><figure><img src="media/value-types@2144255542.svg" alt="Value types" style="width: 80.0%;" /></figure><p>Whenever a function returns some <span class="codespan-content"><code>OutputValue</code></span>, it must be converted to some <span class="codespan-content"><code>Node</code></span> that can be rendered on screen. For instance, a <span class="codespan-content"><code>StringValue</code></span> becomes text, an <span class="codespan-content"><code>OrderedCollectionValue</code></span> becomes an ordered list, a <span class="codespan-content"><code>BooleanValue</code></span> becomes a checkbox, a <span class="codespan-content"><code>DictionaryValue</code></span> becomes a table, and so on. This operation is handled by a <em>value-node mapper</em>.</p><p>For each function call node enqueued by the parser, the corresponding function is looked up among loaded libraries<sup class="footnote-reference footnote-label" data-definition="__footnote-1"><a href="#__footnote-1">1</a></sup>, argument-parameter bindings are established<sup class="footnote-reference footnote-label" data-definition="__footnote-2"><a href="#__footnote-2">2</a></sup>, and the function is executed to obtain its output.
After retrieving the output node from the mapper, the expander can push it to the function call&rsquo;s child nodes, ready for the next stage.</p><span class="footnote-definition" id="__footnote-1" data-footnote-index="0"><sup class="footnote-label">1</sup><span>User-defined functions are also dynamically stored into a volatile library. Native libraries (e.g. <span class="codespan-content"><code>stdlib</code></span>) load their functions via reflection instead.</span></span><span class="footnote-definition" id="__footnote-2" data-footnote-index="1"><sup class="footnote-label">2</sup><span>Quarkdown is <a href="../Typing">dynamically typed</a>, while the native libraries are written in a statically typed language (Kotlin). When an argument-parameter binding is created, if the argument&rsquo;s type is dynamic, a conversion to its parameter&rsquo;s static type is performed via the <span class="codespan-content"><code>ValueFactory</code></span>. If the conversion fails, an error is thrown.</span></span>
        <div id="footnote-area">
          <div class="footnote-rule"></div>
        </div>
        <div id="sibling-pages-button-area"></div>
        <footer>
          <div class="position-left"></div>
          <div class="position-center"></div>
          <div class="position-right"></div>
        </footer>
      </main>
      <aside class="margin-area" id="margin-area-right">
        <div class="position-top"></div>
        <div class="position-middle"></div>
        <div class="position-bottom"></div>
      </aside>
    </div>
  </body>
</html>
